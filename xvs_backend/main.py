# Start Flask
#   cd to backend directory
#   1. env\Scripts\activate
#   2. flask run (debug mode will be off)
#      - py main.py (debug on)

# Stop Flask
#   1. ctrl+C
#   2. deactivate
from flask import Flask, request, session, jsonify
from html.parser import HTMLParser
from flask_cors import CORS


app = Flask("__name__")
CORS(app)

from html.parser import HTMLParser

class MyHTMLParser(HTMLParser):
  def __init__(self):
    HTMLParser.__init__(self)
    self.data = []

  def handle_starttag(self, tag, attrs):
      print("Encountered a start tag:", tag)

  def handle_endtag(self, tag):
      print("Encountered an end tag :", tag)

  def handle_data(self, data):
      print("Encountered some data  :", data)
      self.data.append(data)


@app.route("/")
def index(): 
  return "<h1>Flask Running</h1>"



@app.route("/analyze", methods=["POST", "GET"])
def analyze():
  parser = MyHTMLParser()
  if request.method == "POST":
    print("\nRecieved POST Request\n")
    print("JSON?")
    print(request.is_json)
    content = request.get_json()
    print(content)

    print("Data:\n" + content["data"] + "\n")
    parser.feed(content["data"])
    session["data"] = parser.data

    return jsonify({"status": "Post Request Success", "data": content})

  if request.method == "GET":
    print("Recieved GET Request")
    print(session.get("data"))

    return jsonify({"status": "GET Request Success", "data": content})

  return "Analyzing..."


if __name__ == "__main__":
    app.secret_key = 'super secret key'
    # app.config['SESSION_TYPE'] = 'filesystem'
    app.debug = True
    app.run()



# Installed:
#   py -m pip install -U autopep8
#   pip install html.parser 
#   pip install -U flask-cors
